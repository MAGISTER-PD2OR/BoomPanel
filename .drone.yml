pipeline:
  language:
    image: ubuntu
    commands:
      - apt-get update
      - apt-get install -y gettext bash python python-dev git openssh-client
      - eval `ssh-agent -s`
      - mkdir -p /ssh
      - echo '$GIT_PUSH_SSH_KEY' > /ssh/key
      - chmod 600 /ssh/key
      - yes '\n' | ssh-add /ssh/key
      - cd WEB/lang
      - bash export.bash
      - git config --global user.email "bilalmahmoud@posteo.net"
      - git config --global user.name "indietyp"
      - git config --global push.default simple
      - git add -A
      - git commit -m "[skip ci] translation webhook"
      - git remote set-url origin "https://git@github.com/boomix/BoomPanel.git"
      - git push --set-upstream origin HEAD
      - git push
    secrets: [ git_push_ssh_key ]

  # git_push:
  #   image: appleboy/drone-git-push
  #   branch: dev
  #   remote: https://github.com/boomix/BoomPanel.git
  #   force: false
  #   commit: true

  publish:
    image: plugins/docker
    registry: registry.indietyp.com
    repo: registry.indietyp.com/boom/boompanel
    secrets: [ docker_username, docker_password ]
    tags: latest
